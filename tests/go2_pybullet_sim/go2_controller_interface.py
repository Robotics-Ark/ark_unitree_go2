{
    "cells": [
        {
            "cell_type": "code",
            "execution_count": 13,
            "id": "d589358a",
            "metadata": {},
            "outputs": [],
            "source": [
                "import numpy as np\n",
                "from arktypes import joint_group_command_t, task_space_command_t, joint_state_t\n",
                "from arktypes.utils import unpack, pack\n",
                "from ark.client.comm_infrastructure.instance_node import InstanceNode\n",
                "import pickle",
            ],
        },
        {
            "cell_type": "code",
            "execution_count": 14,
            "id": "034f96b3",
            "metadata": {},
            "outputs": [
                {
                    "name": "stderr",
                    "output_type": "stream",
                    "text": [
                        "\u001b[93m[WARNING] [17:37:08.884435] - No global configuration provided. Using default system configuration.\u001b[0m\n",
                        "\u001b[96m[INFO] [17:37:08.886250] - Service: Successfully registered '__DEFAULT_SERVICE/GetInfo/GO2Controller_c01d9634-a7cd-4024-afbf-e4e5829d2b12' with registry.\u001b[0m\n",
                        "\u001b[96m[INFO] [17:37:08.887526] - Service: Successfully registered '__DEFAULT_SERVICE/SuspendNode/GO2Controller_c01d9634-a7cd-4024-afbf-e4e5829d2b12' with registry.\u001b[0m\n",
                        "\u001b[96m[INFO] [17:37:08.888338] - Service: Successfully registered '__DEFAULT_SERVICE/RestartNode/GO2Controller_c01d9634-a7cd-4024-afbf-e4e5829d2b12' with registry.\u001b[0m\n",
                        "\u001b[91m[ERROR] [17:37:08.888971] - Couldn't load config for other 'GO2Controller'\u001b[0m\n",
                        "\u001b[92m\u001b[1m[OK] [17:37:08.889379] - setup publisher unitree_go2/joint_group_command[joint_group_command_t]\u001b[0m\n",
                        "\u001b[92m\u001b[1m[OK] [17:37:08.889590] - subscribed to unitree_go2/joint_states[joint_state_t]\u001b[0m\n",
                    ],
                },
                {"name": "stdout", "output_type": "stream", "text": ["None\n"]},
            ],
            "source": [
                "SIM = True\n",
                "\n",
                "class GO2ControllerNode(InstanceNode):\n",
                "\n",
                "    def __init__(self):\n",
                "        '''\n",
                "        Initialize the GO2.\n",
                "        This class is responsible for controlling the Husky robot's joints.\n",
                "        '''\n",
                '        super().__init__("GO2Controller")\n',
                "\n",
                "        if SIM == True:\n",
                '            self.joint_group_command = self.create_publisher("unitree_go2/joint_group_command", joint_group_command_t)\n',
                "\n",
                '            self.state = self.create_listener("unitree_go2/joint_states", joint_state_t)\n',
                "\n",
                "controller = GO2ControllerNode()",
            ],
        },
        {
            "cell_type": "markdown",
            "id": "319568af",
            "metadata": {},
            "source": [
                "* FL\\_hip\\_joint\n",
                "* FL\\_thigh\\_joint\n",
                "* FL\\_calf\\_joint\n",
                "* FR\\_hip\\_joint\n",
                "* FR\\_thigh\\_joint\n",
                "* FR\\_calf\\_joint\n",
                "* RL\\_hip\\_joint\n",
                "* RL\\_thigh\\_joint\n",
                "* RL\\_calf\\_joint\n",
                "* RR\\_hip\\_joint\n",
                "* RR\\_thigh\\_joint\n",
                "* RR\\_calf\\_joint",
            ],
        },
        {
            "cell_type": "code",
            "execution_count": null,
            "id": "02326837",
            "metadata": {},
            "outputs": [
                {
                    "ename": "KeyboardInterrupt",
                    "evalue": "",
                    "output_type": "error",
                    "traceback": [
                        "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
                        "\u001b[0;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)",
                        'Cell \u001b[0;32mIn[15], line 6\u001b[0m\n\u001b[1;32m      4\u001b[0m \u001b[38;5;66;03m# Velocity Control\u001b[39;00m\n\u001b[1;32m      5\u001b[0m \u001b[38;5;28;01mwhile\u001b[39;00m \u001b[38;5;28;01mTrue\u001b[39;00m:\n\u001b[0;32m----> 6\u001b[0m     \u001b[43mcontroller\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mjoint_group_command\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mpublish\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpack\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mjoint_group_command\u001b[49m\u001b[43m(\u001b[49m\u001b[43mjoint_command\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;124;43m"\u001b[39;49m\u001b[38;5;124;43mall\u001b[39;49m\u001b[38;5;124;43m"\u001b[39;49m\u001b[43m)\u001b[49m\u001b[43m)\u001b[49m\n',
                        'File \u001b[0;32m~/ark_examples/ark_framework/ark/client/comm_handler/publisher.py:41\u001b[0m, in \u001b[0;36mPublisher.publish\u001b[0;34m(self, msg)\u001b[0m\n\u001b[1;32m     38\u001b[0m \u001b[38;5;28;01massert\u001b[39;00m \u001b[38;5;28mtype\u001b[39m(msg) \u001b[38;5;241m==\u001b[39m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mchannel_type, \u001b[38;5;124mf\u001b[39m\u001b[38;5;124m"\u001b[39m\u001b[38;5;124mWrong Message Type send to Channel \u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mchannel_name\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m"\u001b[39m\n\u001b[1;32m     40\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;28mself\u001b[39m\u001b[38;5;241m.\u001b[39mactive:\n\u001b[0;32m---> 41\u001b[0m     \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_lcm\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mpublish\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mchannel_name\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mchannel_type\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mencode\u001b[49m\u001b[43m(\u001b[49m\u001b[43mmsg\u001b[49m\u001b[43m)\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m     42\u001b[0m \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[1;32m     43\u001b[0m     log\u001b[38;5;241m.\u001b[39mwarning(\u001b[38;5;124mf\u001b[39m\u001b[38;5;124m"\u001b[39m\u001b[38;5;124mpublisher \u001b[39m\u001b[38;5;132;01m{\u001b[39;00m\u001b[38;5;28mself\u001b[39m\u001b[38;5;132;01m}\u001b[39;00m\u001b[38;5;124m is not enabled, cannot publish messages\u001b[39m\u001b[38;5;124m"\u001b[39m)\n',
                        "\u001b[0;31mKeyboardInterrupt\u001b[0m: ",
                    ],
                }
            ],
            "source": [
                "# FORWARDS\n",
                "joint_command = [0.0, 1.36, -2.65, 0.0, 1.36, -2.65,\n",
                "                             -0.2, 1.36, -2.65, 0.2, 1.36, -2.65]\n",
                "# Velocity Control\n",
                "while True:\n",
                '    controller.joint_group_command.publish(pack.joint_group_command(joint_command, "all"))',
            ],
        },
        {
            "cell_type": "code",
            "execution_count": 17,
            "id": "99d6fa94",
            "metadata": {},
            "outputs": [
                {
                    "data": {
                        "text/plain": [
                            "({'seq': 0, 'stamp': {'sec': 0, 'nsec': 0}, 'frame_id': ''},\n",
                            " ['FL_hip_joint',\n",
                            "  'FL_thigh_joint',\n",
                            "  'FL_calf_joint',\n",
                            "  'FR_hip_joint',\n",
                            "  'FR_thigh_joint',\n",
                            "  'FR_calf_joint',\n",
                            "  'RL_hip_joint',\n",
                            "  'RL_thigh_joint',\n",
                            "  'RL_calf_joint',\n",
                            "  'RR_hip_joint',\n",
                            "  'RR_thigh_joint',\n",
                            "  'RR_calf_joint'],\n",
                            " array([ 9.98395096e-01,  5.73586253e-05, -8.37671272e-01,  6.46626586e-04,\n",
                            "         4.77678354e-05, -8.37905534e-01, -5.37067286e-02, -4.86142702e-01,\n",
                            "         3.44827894e-01,  2.18173469e-02,  1.09331965e-02,  4.49893060e-02]),\n",
                            " array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]),\n",
                            " array([0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0., 0.]))",
                        ]
                    },
                    "execution_count": 17,
                    "metadata": {},
                    "output_type": "execute_result",
                }
            ],
            "source": ["unpack.joint_state(controller.state.get())"],
        },
    ],
    "metadata": {
        "kernelspec": {
            "display_name": "ark_env",
            "language": "python",
            "name": "python3",
        },
        "language_info": {
            "codemirror_mode": {"name": "ipython", "version": 3},
            "file_extension": ".py",
            "mimetype": "text/x-python",
            "name": "python",
            "nbconvert_exporter": "python",
            "pygments_lexer": "ipython3",
            "version": "3.10.18",
        },
    },
    "nbformat": 4,
    "nbformat_minor": 5,
}
